import{stringify as t}from"qs";class r{constructor(t,r,e){if(this.name=t,this.ziggy=e,this.route=this.ziggy.namedRoutes[this.name],void 0===this.name)throw new Error("Ziggy Error: You must provide a route name");if(void 0===this.route)throw new Error("Ziggy Error: route '"+this.name+"' is not found in the route list");this.absolute=void 0===r||r,this.domain=this.setDomain(),this.path=this.route.uri.replace(/^\//,"")}setDomain(){if(!this.absolute)return"/";if(!this.route.domain)return this.ziggy.baseUrl.replace(/\/?$/,"/");let t=(this.route.domain||this.ziggy.baseDomain).replace(/\/+$/,"");return this.ziggy.basePort&&(t=t+":"+this.ziggy.basePort),this.ziggy.baseProtocol+"://"+t+"/"}construct(){return this.domain+this.path}}class e extends String{constructor(t,e,i,s=null){super(),this.name=t,this.absolute=i,this.ziggy=s||Ziggy,this.urlBuilder=this.name?new r(t,i,this.ziggy):null,this.template=this.urlBuilder?this.urlBuilder.construct():"",this.urlParams=this.normalizeParams(e),this.queryParams={},this.hydrated=""}normalizeParams(t){return void 0===t?{}:(t="object"!=typeof t?[t]:t,this.numericParamIndices=Array.isArray(t),Object.assign({},t))}with(t){return this.urlParams=this.normalizeParams(t),this}withQuery(t){return Object.assign(this.queryParams,t),this}hydrateUrl(){if(this.hydrated)return this.hydrated;let t=this.template.replace(/{([^}]+)}/gi,(t,r)=>{var e,i;let s,a,n=this.trimParam(t);if(this.ziggy.defaultParameters.hasOwnProperty(n)&&(s=this.ziggy.defaultParameters[n]),s&&!this.urlParams[n])return delete this.urlParams[n],s;this.numericParamIndices?(this.urlParams=Object.values(this.urlParams),a=this.urlParams.shift()):(a=this.urlParams[n],delete this.urlParams[n]);let h=null===(e=this.ziggy.namedRoutes[this.name])||void 0===e||null===(i=e.bindings)||void 0===i?void 0:i[n];if(h&&!this.urlParams[n]&&this.urlParams[h]?(a=this.urlParams[h],delete this.urlParams[h]):a||this.urlParams[n]||!this.urlParams.id||(a=this.urlParams.id,delete this.urlParams.id),null==a){if(-1===t.indexOf("?"))throw new Error("Ziggy Error: '"+n+"' key is required for route '"+this.name+"'");return""}return a.id?encodeURIComponent(a.id):a[h]?encodeURIComponent(a[h]):encodeURIComponent(a)});return null!=this.urlBuilder&&""!==this.urlBuilder.path&&(t=t.replace(/\/+$/,"")),this.hydrated=t,this.hydrated}matchUrl(){let t=window.location.hostname+(window.location.port?":"+window.location.port:"")+window.location.pathname,r=this.template.replace(/(\/\{[^\}]*\?\})/g,"/").replace(/(\{[^\}]*\})/gi,"[^/?]+").replace(/\/?$/,"").split("://")[1],e=this.template.replace(/(\{[^\}]*\})/gi,"[^/?]+").split("://")[1],i=t.replace(/\/?$/,"/");const s=new RegExp("^"+e+"/$").test(i),a=new RegExp("^"+r+"/$").test(i);return s||a}constructQuery(){if(0===Object.keys(this.queryParams).length&&0===Object.keys(this.urlParams).length)return"";let r=Object.assign(this.urlParams,this.queryParams);return t(r,{encodeValuesOnly:!0,skipNulls:!0,addQueryPrefix:!0,arrayFormat:"indices"})}current(t=null){let r=Object.keys(this.ziggy.namedRoutes).filter(t=>-1!==this.ziggy.namedRoutes[t].methods.indexOf("GET")&&new e(t,void 0,void 0,this.ziggy).matchUrl())[0];return t?new RegExp("^"+t.replace(".","\\.").replace("*",".*")+"$","i").test(r):r}check(t){return Object.keys(this.ziggy.namedRoutes).includes(t)}extractParams(t,r,e){const i=t.split(e);return r.split(e).reduce((t,r,e)=>0===r.indexOf("{")&&-1!==r.indexOf("}")&&i[e]?Object.assign(t,{[this.trimParam(r)]:i[e]}):t,{})}get params(){const t=this.ziggy.namedRoutes[this.current()];let r=window.location.pathname.replace(this.ziggy.baseUrl.split("://")[1].split("/")[1],"").replace(/^\/+/,"");return Object.assign(this.extractParams(window.location.hostname,t.domain||"","."),this.extractParams(r,t.uri,"/"))}parse(){this.return=this.hydrateUrl()+this.constructQuery()}url(){return this.parse(),this.return}toString(){return this.url()}trimParam(t){return t.replace(/{|}|\?/g,"")}valueOf(){return this.url()}}export default function(t,r,i,s){return new e(t,r,i,s)}
//# sourceMappingURL=route.m.js.map
